Las fuentes proporcionan información detallada sobre las Plantillas de Azure Resource Manager (ARM), pero no ofrecen ejemplos completos de plantillas. Sin embargo, podemos construir un ejemplo basándonos en la información proporcionada.
Ejemplo 1: Creación de una cuenta de almacenamiento:
Este ejemplo se basa en el ejemplo proporcionado en nuestra conversación previa.
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "storageAccountName": {
      "type": "string",
      "metadata": {
        "description": "Nombre de la cuenta de almacenamiento a crear"
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Ubicación de la cuenta de almacenamiento"
      }
    }
  },
  "variables": {},
  "resources": [
    {
      "type": "Microsoft.Storage/storageAccounts",
      "apiVersion": "2019-06-01",
      "name": "[parameters('storageAccountName')]",
      "location": "[parameters('location')]",
      "sku": {
        "name": "Standard_LRS"
      },
      "kind": "StorageV2",
      "properties": {}
    }
  ],
  "outputs": {}
}
Explicación:
●
$schema: Define la versión del esquema JSON para la plantilla.
●
contentVersion: Versión de la plantilla.
●
parameters: Define parámetros de entrada para personalizar la plantilla (nombre y ubicación de la cuenta).
●
variables: Define variables internas para la plantilla (vacío en este caso).
●
resources: Define los recursos a crear (una cuenta de almacenamiento).
●
outputs: Define valores de salida de la plantilla (vacío en este caso).
Ejemplo 2: Despliegue de una máquina virtual con extensión de script (fuente):
Este ejemplo se basa en la descripción de un enfoque modular para plantillas ARM.
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    // ... parámetros para la máquina virtual ...
  },
  "resources": [
    {
      // ... definición de la máquina virtual ...
    },
    {
      "type": "Microsoft.Compute/virtualMachines/extensions",
      "name": "[concat(parameters('vmName'),'/dockerExtension')]",
      "apiVersion": "2019-07-01",
      "location": "[parameters('location')]",
      "properties": {
        "publisher": "Microsoft.Azure.Extensions",
        "type": "CustomScriptExtension",
        "typeHandlerVersion": "1.9",
        "autoUpgradeMinorVersion": true,
        "settings": {
          "fileUris": [
            "[concat(parameters('templateBaseUrl'), 'scripts/docker-install.ps1')]"
          ],
          "commandToExecute": "powershell.exe -ExecutionPolicy Unrestricted -File docker-install.ps1"
        },
        "protectedSettings": {}
      }
    }
  ]
}
Explicación:
●
Esta plantilla despliega una máquina virtual y una extensión de script personalizada.
●
La extensión descarga un script (docker-install.ps1) desde una URL base y lo ejecuta.
●
El script instala Docker en la máquina virtual, preparando el entorno para contenedores.
Conceptos clave de las plantillas ARM:
●
Modularidad: Se pueden dividir plantillas complejas en módulos reutilizables (fuentes).
●
Parámetros y variables: Permiten la personalización y reutilización de las plantillas.
●
Recursos anidados: Se pueden definir recursos dentro de otros recursos (como la extensión de script).
●
Plantillas maestras: Permiten combinar plantillas modulares para crear soluciones complejas (fuente).
Beneficios de las plantillas ARM:
●
Automatización: Despliegue repetible y consistente de la infraestructura.
●
Control de versiones: Seguimiento de cambios y reversión a versiones anteriores.
●
Infraestructura como código: Gestión de la infraestructura como si fuera código fuente.
●
Colaboración: Facilita el trabajo en equipo en proyectos de infraestructura.
Información adicional:
La documentación oficial de Microsoft ofrece una amplia gama de ejemplos y tutoriales sobre plantillas ARM: https://docs.microsoft.com/azure/azure-resource-manager/
